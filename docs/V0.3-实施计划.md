# V0.3 实施计划 - 互动效果与 AI 知识库

## 目标
让网站更有趣、更有动漫感，增强 AI 问答能力

---

## 功能拆解

### 功能 1: 角色口头禅（气泡提示）

#### 步骤分解

| 步骤 | 任务 | 技能 | 需要下载 |
|------|------|------|----------|
| 1.1 | 为每个项目配置口头禅 | TypeScript 类型定义 | ❌ |
| 1.2 | 创建气泡提示组件 | React 组件开发 | ❌ |
| 1.3 | 实现点击触发逻辑 | React useState | ❌ |
| 1.4 | 添加气泡弹出动画 | CSS 动画 | ❌ |
| 1.5 | 点击外部关闭气泡 | React useEffect + 事件监听 | ❌ |

#### 详细任务

**1.1 配置口头禅数据**
```typescript
// app/page.tsx
const PROJECTS: Project[] = [
  {
    emoji: '🐒',
    title: '极简记账本',
    description: '简洁高效的记账工具',
    link: 'https://minimal-ledger.vercel.app/',
    catchphrase: '龟派气功！💥',  // 新增
  },
  // ... 其他项目
];
```

**1.2 创建气泡组件**
```tsx
// components/CatchphraseBubble.tsx
interface CatchphraseBubbleProps {
  emoji: string;
  catchphrase: string;
  isVisible: boolean;
  onClose: () => void;
}
```

**1.3 点击触发**
- 在 ProjectCard 中添加点击事件
- 显示对应的口头禅气泡

**1.4 CSS 动画**
- 气泡从卡片位置弹出
- 淡入 + 向上位移 + 缩放
- 七龙珠主题样式（橙色边框 + 金色文字）

**1.5 点击外部关闭**
- 监听 document 点击事件
- 判断点击目标是否在气泡外

#### 技能检查
| 技能 | 当前掌握 | 需要学习 |
|------|----------|----------|
| React hooks (useState, useEffect) | ✅ 有 | - |
| CSS 动画 | ✅ 有 | - |
| 事件监听 | ✅ 有 | - |
| TypeScript | ✅ 有 | - |

#### 依赖包
❌ **无需下载新包**

---

### 功能 2: 鼠标悬停动画增强

#### 步骤分解

| 步骤 | 任务 | 技能 | 需要下载 |
|------|------|------|----------|
| 2.1 | 卡片悬停效果增强 | Tailwind CSS | ❌ |
| 2.2 | 角色 emoji 动画 | CSS @keyframes | ❌ |
| 2.3 | 能量光晕效果 | box-shadow 动画 | ❌ |
| 2.4 | 龙珠装饰互动 | CSS 交互效果 | ❌ |

#### 详细任务

**2.1 卡片悬停效果**
```css
/* 当前效果 */
hover:scale-105

/* 新增效果 */
- 边框发光动画
- 背景渐变闪烁
- 阴影扩散
```

**2.2 角色 emoji 动画**
```css
@keyframes character-pop {
  0% { transform: scale(1) rotate(0deg); }
  50% { transform: scale(1.2) rotate(5deg); }
  100% { transform: scale(1) rotate(0deg); }
}
```

**2.3 能量光晕效果**
```css
/* 龙珠能量光晕 */
@keyframes energy-glow {
  0%, 100% {
    box-shadow: 0 0 20px var(--dragon-orange);
  }
  50% {
    box-shadow: 0 0 40px var(--dragon-gold), 0 0 60px var(--dragon-orange);
  }
}
```

**2.4 龙珠装饰互动**
- 悬停时龙珠闪烁
- 轻微旋转动画

#### 技能检查
| 技能 | 当前掌握 | 需要学习 |
|------|----------|----------|
| Tailwind CSS | ✅ 有 | - |
| CSS 动画 | ✅ 有 | - |
| CSS 伪类 | ✅ 有 | - |

#### 依赖包
❌ **无需下载新包**

---

### 功能 3: AI 知识库接入（RAG）

#### 步骤分解

| 步骤 | 任务 | 技能 | 需要下载 |
|------|------|------|----------|
| 3.1 | 文章分块 | 字符串处理 | ❌ |
| 3.2 | 生成文本嵌入 | Embeddings API | ✅ **是** |
| 3.3 | 存储向量到 Upstash | Upstash Vector SDK | ❌ |
| 3.4 | 向量相似度搜索 | Upstash Vector 查询 | ❌ |
| 3.5 | 构造 RAG prompt | Prompt 工程 | ❌ |
| 3.6 | 集成到聊天 API | API 调用 | ❌ |

#### 详细任务

**3.1 文章分块**
```typescript
// 将长文章分割成小块
function chunkArticle(content: string, chunkSize = 500): string[] {
  // 按段落分割
  // 每块约 500 字符
  // 重叠 50 字符保持上下文
}
```

**3.2 生成文本嵌入**
```typescript
// 使用 embeddings API
import { OpenAI } from 'openai';

const openai = new OpenAI({ apiKey: process.env.OPENAI_API_KEY });

async function generateEmbedding(text: string): Promise<number[]> {
  const response = await openai.embeddings.create({
    model: 'text-embedding-3-small',
    input: text,
  });
  return response.data[0].embedding;
}
```

**3.3 存储向量**
```typescript
import { Index } from '@upstash/vector';

const index = new Index({
  url: process.env.UPSTASH_VECTOR_REST_URL,
  token: process.env.UPSTASH_VECTOR_REST_TOKEN,
});

await index.upsert({
  id: `chunk-${articleId}-${chunkIndex}`,
  vector: embedding,
  metadata: {
    articleId,
    title,
    content: chunk,
  },
});
```

**3.4 向量搜索**
```typescript
// 查询最相关的文章块
const results = await index.query({
  vector: queryEmbedding,
  topK: 3,
  includeMetadata: true,
});
```

**3.5 构造 RAG prompt**
```typescript
const systemPrompt = `
你是 Double兔 作品集的 AI 助手。

参考文章内容：
${relevantChunks.map(c => c.content).join('\n---\n')}

请基于以上参考内容回答用户问题。如果参考内容中没有相关信息，请诚实告知。
`;
```

**3.6 集成到聊天**
- 修改 `/api/chat` 路由
- 添加向量检索步骤
- 增强 system prompt

#### 技能检查
| 技能 | 当前掌握 | 需要学习 |
|------|----------|----------|
| RAG 概念 | ❌ 无 | ✅ **需要学习** |
| Embeddings API | ❌ 无 | ✅ **需要学习** |
| Upstash Vector | ⚠️ 已配置但未使用 | ✅ **需要学习** |
| 向量相似度搜索 | ❌ 无 | ✅ **需要学习** |
| Prompt 工程 | ⚠️ 基础 | ✅ **需要学习** |

#### 依赖包

**需要下载的包**：
```bash
# OpenAI SDK（用于 embeddings）
npm install openai

# 或使用其他 embeddings 服务：
# - MixBread AI（免费，推荐）
npm install @xai-ai/sdk

# Upstash Vector（可能已有）
npm install @upstash/vector
```

#### 环境变量（需要配置）
```bash
# .env.local
OPENAI_API_KEY=sk-xxx           # OpenAI API Key
# 或
MIXBREAD_API_KEY=xxx            # MixBread API Key

UPSTASH_VECTOR_REST_URL=https://xxx.upstash.io
UPSTASH_VECTOR_REST_TOKEN=xxxxx
```

---

## 技能学习计划

### RAG 技能（优先学习）

**学习资源**：
1. **Upstash Vector 文档**
   - https://upstash.com/docs/vector
   - 重点：Quick Start、Embeddings、Query

2. **RAG 基础概念**
   - 什么是 Embeddings
   - 向量相似度计算
   - RAG 架构设计

3. **实践教程**
   - Vercel AI SDK + RAG 示例
   - Upstash Vector 示例项目

**预计学习时间**：2-3 小时

---

## 实施顺序建议

### 方案 A：渐进式（推荐）

```
第 1 天：角色口头禅
├── 上午：配置数据 + 创建组件
└── 下午：动画效果 + 测试

第 2 天：悬停动画增强
├── 上午：卡片动画
└── 下午：龙珠互动 + 整体调优

第 3-4 天：AI 知识库
├── 学习 RAG 概念（2小时）
├── 配置环境（1小时）
├── 实现分块 + 嵌入（半天）
└── 实现检索 + 集成（半天）
```

### 方案 B：简化版（跳过 RAG）

```
第 1 天：角色口头禅
第 2 天：悬停动画增强
（AI 知识库延后到 V0.4）
```

---

## 依赖包清单

### 当前已有
```json
{
  "next": "15.x",
  "react": "^18.x",
  "typescript": "^5.x",
  "tailwindcss": "^3.x",
  "@upstash/vector": "latest",  // 可能已安装
  "react-markdown": "latest",
  "remark-gfm": "latest",
  "rehype-highlight": "latest"
}
```

### V0.3 需要新增

**功能 1 + 2（口头禅 + 动画）**：
```
无需新增依赖
```

**功能 3（AI 知识库）**：
```bash
# 选择一个 embeddings 服务
npm install openai              # OpenAI embeddings（付费）
# 或
npm install @mixbread-ai/sdk    # MixBread（免费，推荐）

# Upstash Vector（检查是否已有）
npm install @upstash/vector     # 如果没有则安装
```

---

## 验收标准

### 功能 1: 角色口头禅
- [ ] 点击项目卡片显示口头禅气泡
- [ ] 气泡样式符合七龙珠主题
- [ ] 气泡动画流畅
- [ ] 点击外部可关闭气泡
- [ ] 5 个项目各有独特口头禅

### 功能 2: 悬停动画
- [ ] 卡片悬停时有明显视觉反馈
- [ ] 角色 emoji 有弹跳动画
- [ ] 能量光晕效果流畅
- [ ] 龙珠装饰有互动效果
- [ ] 所有动画不卡顿

### 功能 3: AI 知识库（可选）
- [ ] 文章上传时自动生成向量
- [ ] AI 能基于文章内容回答问题
- [ ] 相关文章内容被正确检索
- [ ] 回答质量明显提升

---

## 风险评估

| 风险 | 影响 | 缓解措施 |
|------|------|----------|
| RAG 技术难度高 | 可能延期 | 先做功能 1+2，RAG 可延后 |
| Embeddings API 费用 | 增加成本 | 使用 MixBread 免费方案 |
| Upstash 配额限制 | 存储限制 | 控制文章数量，使用免费层 |
| 向量检索准确性 | 回答质量差 | 调优 chunk 大小和 topK 值 |

---

## 总结

### 需要下载的包
| 功能 | 包名 | 用途 | 是否必需 |
|------|------|------|----------|
| 口头禅 + 动画 | - | - | ❌ 无需下载 |
| AI 知识库 | `openai` 或 `@mixbread-ai/sdk` | Embeddings | ✅ 是 |
| AI 知识库 | `@upstash/vector` | 向量数据库 | ⚠️ 检查是否已有 |

### 需要学习的技能
| 技能 | 难度 | 预计时间 |
|------|------|----------|
| RAG 概念 | ⭐⭐⭐ | 1-2 小时 |
| Upstash Vector 使用 | ⭐⭐ | 1 小时 |
| Embeddings API | ⭐⭐ | 1 小时 |

### 建议实施顺序
1. **先做功能 1+2**（口头禅 + 动画）- 基于现有技能
2. **评估功能 3**（RAG）- 如果时间充裕再做

---

*创建时间：2025-02-04*
*版本：V0.3 实施计划*
